## 知识点总结

#### 1、ThreadLocal 原理(https://juejin.im/post/59db31c16fb9a00a4843dc36)
* set 存储句柄为 当前currentThread
* 存储到Thread 中的 ThreadLocalMap中
* 存储类型为Entry
* Entry 是继承的弱引用，泛型是TreadLocal<?> ，目的是弱引用，当线程池复用的时候不引起内存泄漏。


#### 2、ClassLoader（延伸 tinker 热修的原理）
* ClassLoader分系统ClassLoader 、自定义 ClassLoader
* 系统ClassLoader 分 BootStrapClassLoader 、  ExtensionsClassLoader 、 AppClassLoader
* 双亲委托加载机制，就是向上传递，先从自定义ClassLoader加载，再向AppClassLoader，再向ExtensionsClassLoader，最后到BootStrapClassLoader，中间每次先去缓存去取，再去所负责的路径下去加载，加载不到向上传递，直到成功。
* android 中主要是用的DexClassLoader  与 PathClassLoader
* Tinker是利用类加载机制去做的，把补丁类 整合到dex文件，利用App启动后，在DexClassLoader与 PathClassLoader加载项目的class时，父类BaseDexClassLoader去findClass，是在父类变量DexPathList中去加载项目类，DexPathList保存了需要加载的dex，apk，jar，zip等文件路径，最后热修的原理就是把补丁类加入到DexPathList之前，让ClassLoader先去加载，然后后面的bug类加载的时候，缓存中已经有了这个类，所以跳过加载，起到热修作用。

